#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä¸“ä¸šPDFç”Ÿæˆå™¨æµ‹è¯•è„šæœ¬
ç”Ÿæˆæ¼”ç¤ºPDFä»¥å±•ç¤ºä¸“ä¸šæŠ¥å‘Šé£æ ¼
"""

import pandas as pd
import numpy as np
from datetime import datetime, timedelta
from pdf_generator_professional import generate_professional_pdf_report

def generate_demo_stock_data():
    """ç”Ÿæˆæ¼”ç¤ºè‚¡ç¥¨æ•°æ®"""
    # ç”Ÿæˆ30å¤©çš„Kçº¿æ•°æ®
    dates = pd.date_range(end=datetime.now(), periods=30, freq='D')
    np.random.seed(42)
    
    base_price = 50
    prices = []
    current_price = base_price
    
    for _ in range(30):
        change = np.random.randn() * 2
        current_price += change
        prices.append(current_price)
    
    kline_data = pd.DataFrame({
        'æ—¥æœŸ': dates,
        'å¼€ç›˜': [p * (1 + np.random.uniform(-0.02, 0.02)) for p in prices],
        'æ”¶ç›˜': prices,
        'æœ€é«˜': [p * (1 + np.random.uniform(0, 0.05)) for p in prices],
        'æœ€ä½': [p * (1 - np.random.uniform(0, 0.05)) for p in prices],
        'æˆäº¤é‡': [np.random.randint(1000000, 50000000) for _ in prices],
        'æˆäº¤é¢': [np.random.randint(50000000, 500000000) for _ in prices],
        'æ¶¨è·Œå¹…': [np.random.uniform(-5, 5) for _ in prices],
        'æ¢æ‰‹ç‡': [np.random.uniform(0, 10) for _ in prices],
    })
    
    # æ„é€ å®Œæ•´çš„è‚¡ç¥¨æ•°æ®
    stock_data = {
        'symbol': '000001',
        'name': 'å¹³å®‰é“¶è¡Œ',
        'kline_data': kline_data,
        'market_analysis': {
            'factors': {
                'bullish': [
                    'é“¶è¡Œæ¿å—ä¼°å€¼å¤„äºå†å²ä½ä½ï¼Œå…·æœ‰è¾ƒé«˜å®‰å…¨è¾¹é™…',
                    'æ¯å·®æ”¹å–„é¢„æœŸæ˜æ˜¾ï¼Œå‡€åˆ©æ¯æ”¶å…¥æœ‰æœ›å›å‡',
                    'èµ„äº§è´¨é‡ä¿æŒç¨³å®šï¼Œä¸è‰¯è´·æ¬¾ç‡æŒç»­ä¸‹é™',
                    'é›¶å”®è½¬å‹æˆæ•ˆæ˜¾è‘—ï¼Œä¸­é—´ä¸šåŠ¡æ”¶å…¥å æ¯”æå‡',
                    'é‡‘èç§‘æŠ€æŠ•å…¥åŠ å¤§ï¼Œæ•°å­—åŒ–è½¬å‹é¢†å…ˆåŒä¸š'
                ],
                'bearish': [
                    'å®è§‚ç»æµä¸‹è¡Œå‹åŠ›å¢åŠ ï¼Œä¿¡è´·éœ€æ±‚å¯èƒ½ç–²è½¯',
                    'æˆ¿åœ°äº§é£é™©å°šæœªå®Œå…¨å‡ºæ¸…ï¼Œç›¸å…³è´·æ¬¾éœ€å…³æ³¨',
                    'å­˜æ¬¾ç«äº‰åŠ å‰§ï¼Œè´Ÿå€ºæˆæœ¬ä¸Šå‡å‹åŠ›æ˜æ˜¾',
                    'ç›‘ç®¡æ”¿ç­–è¶‹ä¸¥ï¼Œåˆè§„æˆæœ¬æŒç»­ä¸Šå‡'
                ],
                'industry_hotspots': [
                    'é‡‘èç§‘æŠ€ï¼šé“¶è¡ŒåŠ é€Ÿæ•°å­—åŒ–è½¬å‹ï¼ŒAIæŠ€æœ¯åº”ç”¨è½åœ°',
                    'ç»¿è‰²é‡‘èï¼šæ”¿ç­–æ”¯æŒåŠ›åº¦åŠ å¤§ï¼Œç»¿è‰²ä¿¡è´·è§„æ¨¡æ‰©å¤§',
                    'æ™®æƒ é‡‘èï¼šç›‘ç®¡é¼“åŠ±å°å¾®ä¼ä¸šè´·æ¬¾æŠ•æ”¾å¢é•¿'
                ],
                'market_trends': [
                    'é“¶è¡Œè‚¡ä¼°å€¼ä¿®å¤è¡Œæƒ…å¯åŠ¨ï¼Œå¸‚åœºå…³æ³¨åº¦æå‡',
                    'æ¯å·®ä¼ç¨³ä¿¡å·æ˜ç¡®ï¼Œæ¿å—åŸºæœ¬é¢æ”¹å–„é¢„æœŸå¼ºçƒˆ',
                    'æ”¿ç­–åº•æ˜¾ç°ï¼Œç¨³å¢é•¿æ”¿ç­–æŒç»­å‘åŠ›'
                ]
            },
            'main_funds': {
                'net_inflow': 125600000,  # 1.256äº¿
                'status': 'inflow',
                'daily_data': [
                    {'date': '2026-02-10', 'net': 45000000},
                    {'date': '2026-02-11', 'net': -23000000},
                    {'date': '2026-02-12', 'net': 67000000},
                    {'date': '2026-02-13', 'net': 18000000},
                    {'date': '2026-02-14', 'net': 18600000},
                ]
            },
            'market_context': {
                'industry_trend': 'up',
                'market_trend': 'stable'
            }
        }
    }
    
    return stock_data

def generate_demo_analysis_result():
    """ç”Ÿæˆæ¼”ç¤ºAIåˆ†æç»“æœ"""
    return """
## æŠ€æœ¯é¢åˆ†æ

ä»Kçº¿å½¢æ€æ¥çœ‹ï¼Œè¯¥è‚¡ç¥¨è¿‘æœŸå‘ˆç°éœ‡è¡ä¸Šè¡Œæ€åŠ¿ã€‚å‡çº¿ç³»ç»Ÿå¤šå¤´æ’åˆ—æ˜æ˜¾ï¼ŒçŸ­æœŸå‡çº¿æ”¯æ’‘åŠ›åº¦è¾ƒå¼ºã€‚MACDæŒ‡æ ‡æ˜¾ç¤ºå¤šå¤´åŠ¨èƒ½å¢å¼ºï¼ŒKDJæŒ‡æ ‡å¤„äºè¶…ä¹°åŒºåŸŸï¼Œéœ€è¦å…³æ³¨çŸ­æœŸå›è°ƒé£é™©ã€‚

## åŸºæœ¬é¢åˆ†æ

ä½œä¸ºé“¶è¡Œæ¿å—é¾™å¤´ä¼ä¸šï¼Œå…¬å¸åœ¨é›¶å”®é“¶è¡Œä¸šåŠ¡æ–¹é¢å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚è¿‘æœŸä¸šç»©ç¨³å¥å¢é•¿ï¼Œèµ„äº§è´¨é‡æŒç»­æ”¹å–„ï¼Œæ‹¨å¤‡è¦†ç›–ç‡å……è¶³ï¼ŒæŠ—é£é™©èƒ½åŠ›è¾ƒå¼ºã€‚åœ¨é‡‘èç§‘æŠ€æŠ•å…¥æ–¹é¢é¢†å…ˆåŒä¸šï¼Œæ•°å­—åŒ–è½¬å‹æˆæ•ˆæ˜¾è‘—ã€‚

## å¸‚åœºæƒ…ç»ªåˆ†æ

å½“å‰å¸‚åœºå¯¹é“¶è¡Œæ¿å—å…³æ³¨åº¦æå‡ï¼Œä¼°å€¼ä¿®å¤è¡Œæƒ…é€æ­¥å±•å¼€ã€‚ä¸»åŠ›èµ„é‡‘å‡€æµå…¥æ˜æ˜¾ï¼Œæ˜¾ç¤ºæœºæ„æŠ•èµ„è€…å¯¹è¯¥è‚¡ç¥¨ä¿¡å¿ƒå¢å¼ºã€‚è¡Œä¸šæ”¿ç­–ç¯å¢ƒæ”¹å–„ï¼Œæ¯å·®ä¼ç¨³é¢„æœŸå¼ºçƒˆï¼Œä¸ºæ¿å—æä¾›æœ‰åŠ›æ”¯æ’‘ã€‚

## æŠ•èµ„å»ºè®®

**æ“ä½œç­–ç•¥**: ä¸­é•¿æœŸçœ‹å¥½ï¼Œå»ºè®®é€¢ä½åˆ†æ‰¹å»ºä»“

**ä¹°å…¥å‚è€ƒ**: 48-50å…ƒåŒºé—´åˆ†æ‰¹ä¹°å…¥ï¼Œæ§åˆ¶ä»“ä½åœ¨30%ä»¥å†…

**æ­¢æŸä½ç½®**: è·Œç ´45å…ƒæ­¢æŸï¼Œæ§åˆ¶å•åªè‚¡ç¥¨é£é™©

**æŒä»“å‘¨æœŸ**: å»ºè®®æŒæœ‰3-6ä¸ªæœˆï¼Œå…³æ³¨å­£åº¦ä¸šç»©æŠ«éœ²

**é£é™©æ§åˆ¶**: ä¸¥æ ¼æ‰§è¡Œæ­¢æŸçºªå¾‹ï¼Œé¿å…é‡ä»“å•ä¸€ä¸ªè‚¡

## é£é™©æç¤º

1. å®è§‚ç»æµä¸‹è¡Œé£é™©
2. æˆ¿åœ°äº§å¸‚åœºé£é™©ä¼ å¯¼
3. æ¯å·®æ”¶çª„é£é™©
4. ç›‘ç®¡æ”¿ç­–å˜åŒ–é£é™©
5. å¸‚åœºç³»ç»Ÿæ€§é£é™©

å»ºè®®æŠ•èµ„è€…ä¿æŒç†æ€§ï¼Œæ ¹æ®è‡ªèº«é£é™©æ‰¿å—èƒ½åŠ›è°¨æ…å†³ç­–ã€‚
"""

def test_professional_pdf():
    """æµ‹è¯•ä¸“ä¸šPDFç”Ÿæˆ"""
    print("=" * 60)
    print("ğŸ¨ ä¸“ä¸šPDFç”Ÿæˆå™¨æµ‹è¯•")
    print("=" * 60)
    print()

    print("ğŸ“Š ç”Ÿæˆæ¼”ç¤ºæ•°æ®...")
    stock_data = generate_demo_stock_data()
    analysis_result = generate_demo_analysis_result()
    print("âœ… æ•°æ®ç”Ÿæˆå®Œæˆ")
    print()
    
    print("ğŸ“„ ç”Ÿæˆä¸“ä¸šPDFæŠ¥å‘Š...")
    print(f"   è‚¡ç¥¨: {stock_data['symbol']} {stock_data['name']}")
    print(f"   æ•°æ®é‡: {len(stock_data['kline_data'])} å¤©Kçº¿")
    print()
    
    output_path = generate_professional_pdf_report(stock_data, analysis_result)
    
    if output_path:
        print("=" * 60)
        print("âœ… PDFç”ŸæˆæˆåŠŸï¼")
        print("=" * 60)
        print()
        print(f"ğŸ“ æ–‡ä»¶è·¯å¾„: {output_path}")
        print()
        print("ğŸ“‹ æŠ¥å‘Šç‰¹ç‚¹:")
        print("  âœ¨ ä¸“ä¸šé‡‘èæŠ¥å‘Šé£æ ¼è®¾è®¡")
        print("  ğŸ¨ æ·±è“+é‡‘è‰²é…è‰²æ–¹æ¡ˆ")
        print("  ğŸ“Š æ¸å˜è‰²è¡¨æ ¼å’Œä¿¡æ¯æ¡†")
        print("  ğŸ“ æ¸…æ™°çš„é¡µçœ‰å’Œé¡µè„š")
        print("  ğŸ¯ ç»“æ„åŒ–çš„å†…å®¹åˆ†åŒº")
        print("  âš ï¸  å®Œæ•´çš„é£é™©æç¤º")
        print()
        print("ğŸ’¡ æç¤º:")
        print("  - ä½¿ç”¨PDFé˜…è¯»å™¨æ‰“å¼€æŸ¥çœ‹æ•ˆæœ")
        print("  - å¯¹æ¯”æ—§ç‰ˆPDFæŸ¥çœ‹æ”¹è¿›")
        print("  - æ ¹æ®éœ€è¦å¾®è°ƒæ ·å¼å‚æ•°")
        print()
    else:
        print("âŒ PDFç”Ÿæˆå¤±è´¥")
        print("è¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯å¹¶ä¿®å¤")
        print()
    
    return output_path

if __name__ == '__main__':
    test_professional_pdf()
