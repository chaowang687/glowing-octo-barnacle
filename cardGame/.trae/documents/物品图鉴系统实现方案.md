# 物品图鉴系统实现方案

## 一、系统设计目标

1. **完整的物品展示**：显示所有游戏中存在的物品
2. **详细的物品信息**：包括名称、描述、效果等
3. **收集状态追踪**：显示物品的收集状态（已收集/未收集）
4. **分类与搜索功能**：支持按类型分类和关键词搜索
5. **与背包系统集成**：自动同步背包数据

## 二、核心组件设计

### 1. 图鉴数据管理

**`ItemCodexSO`**：ScriptableObject，存储所有物品图鉴数据
```csharp
[CreateAssetMenu(fileName = "ItemCodex", menuName = "Bag/Item Codex")]
public class ItemCodexSO : ScriptableObject
{
    public List<CodexItem> allItems; // 所有物品列表
    public List<ItemCategory> categories; // 物品分类
}

[Serializable]
public class CodexItem
{
    public string itemID; // 物品唯一ID
    public string itemName; // 物品名称
    [TextArea] public string description; // 物品描述
    public string category; // 物品分类
    public Sprite icon; // 物品图标
    public List<string> effects; // 物品效果描述
}

[Serializable]
public class ItemCategory
{
    public string name; // 分类名称
    public string displayName; // 显示名称
}
```

### 2. 图鉴管理器

**`ItemCodexManager`**：单例管理器，负责图鉴系统的核心逻辑
```csharp
public class ItemCodexManager : MonoBehaviour
{
    public static ItemCodexManager Instance { get; private set; }
    
    public ItemCodexSO codexData; // 图鉴数据
    public HashSet<string> collectedItems; // 已收集物品ID集合
    
    // 事件
    public System.Action OnCollectionStatusChanged;
    
    private void Awake()
    {
        Instance = this;
        DontDestroyOnLoad(gameObject);
        LoadCollectedItems();
        // 监听背包物品变化事件
        InventoryManager.Instance.OnItemChanged += OnItemChanged;
    }
    
    // 处理背包物品变化
    private void OnItemChanged(ItemInstance item, bool isAdded)
    {
        if (isAdded && item != null && item.data != null)
        {
            AddToCollection(item.data.name);
        }
    }
    
    // 添加物品到收集列表
    public void AddToCollection(string itemID)
    {
        if (collectedItems.Add(itemID))
        {
            SaveCollectedItems();
            OnCollectionStatusChanged?.Invoke();
        }
    }
    
    // 检查物品是否已收集
    public bool IsCollected(string itemID)
    {
        return collectedItems.Contains(itemID);
    }
    
    // 保存/加载收集数据
    private void SaveCollectedItems() { /* 实现保存逻辑 */ }
    private void LoadCollectedItems() { /* 实现加载逻辑 */ }
}
```

### 3. 图鉴UI组件

**`ItemCodexUI`**：图鉴主界面
```csharp
public class ItemCodexUI : MonoBehaviour
{
    public Transform categoryPanel; // 分类面板
    public Transform itemGrid; // 物品网格
    public GameObject categoryButtonPrefab; // 分类按钮预制体
    public GameObject itemEntryPrefab; // 物品条目预制体
    public ItemDetailPanel detailPanel; // 物品详情面板
    
    private string currentCategory = "All"; // 当前选中分类
    
    private void OnEnable()
    {
        InitializeCategories();
        UpdateItemGrid();
        // 监听收集状态变化
        ItemCodexManager.Instance.OnCollectionStatusChanged += UpdateItemGrid;
    }
    
    private void OnDisable()
    {
        ItemCodexManager.Instance.OnCollectionStatusChanged -= UpdateItemGrid;
    }
    
    // 初始化分类按钮
    private void InitializeCategories() { /* 实现分类按钮初始化 */ }
    
    // 更新物品网格
    private void UpdateItemGrid() { /* 实现物品网格更新 */ }
    
    // 显示物品详情
    public void ShowItemDetail(CodexItem item) { /* 实现物品详情显示 */ }
}
```

**`ItemDetailPanel`**：物品详情面板
```csharp
public class ItemDetailPanel : MonoBehaviour
{
    public TextMeshProUGUI itemNameText; // 物品名称
    public TextMeshProUGUI descriptionText; // 物品描述
    public Image iconImage; // 物品图标
    public Transform effectsContainer; // 效果容器
    public GameObject effectItemPrefab; // 效果条目预制体
    
    // 显示物品详情
    public void ShowItem(CodexItem item) { /* 实现物品详情显示 */ }
}
```

**`ItemCodexEntry`**：图鉴物品条目
```csharp
public class ItemCodexEntry : MonoBehaviour
{
    public Image iconImage; // 物品图标
    public TextMeshProUGUI nameText; // 物品名称
    public Image collectedIndicator; // 收集指示器
    
    private CodexItem codexItem; // 关联的图鉴物品
    
    // 初始化物品条目
    public void Initialize(CodexItem item) { /* 实现物品条目初始化 */ }
    
    // 点击事件处理
    public void OnItemClicked() { /* 实现物品点击处理 */ }
}
```

## 三、集成与同步

1. **与背包系统集成**：
   - 监听`InventoryManager.OnItemChanged`事件
   - 当获得新物品时，自动更新图鉴收集状态

2. **数据同步**：
   - 图鉴数据存储在ScriptableObject中，便于配置和修改
   - 收集状态存储在PlayerPrefs或游戏存档中

3. **资源管理**：
   - 物品图标使用现有的ItemData中的图标
   - 支持动态加载物品描述和效果

## 四、实现步骤

1. **创建数据结构**：
   - 创建`ItemCodexSO` ScriptableObject
   - 定义图鉴数据结构

2. **实现管理器**：
   - 创建`ItemCodexManager`单例管理器
   - 实现收集状态管理

3. **设计UI组件**：
   - 创建图鉴主界面
   - 创建物品详情面板
   - 创建物品条目组件

4. **集成背包系统**：
   - 监听背包物品变化事件
   - 实现自动更新收集状态

5. **添加分类与搜索功能**：
   - 实现分类按钮
   - 实现搜索功能

6. **测试与优化**：
   - 测试图鉴显示和收集状态更新
   - 优化UI性能

## 五、使用说明

1. **配置图鉴数据**：
   - 在Unity编辑器中创建`ItemCodexSO`资源
   - 添加所有游戏物品到图鉴数据中
   - 配置物品分类

2. **添加图鉴入口**：
   - 在主菜单添加图鉴按钮
   - 点击按钮打开图鉴界面

3. **运行时使用**：
   - 图鉴自动显示所有物品
   - 收集新物品时，图鉴自动更新
   - 支持按分类和搜索浏览物品

## 六、扩展功能

1. **成就系统集成**：实现收集成就
2. **物品来源显示**：显示物品的获取方式
3. **物品组合效果**：显示物品组合效果
4. **图鉴奖励**：收集特定物品获得奖励

通过以上设计，我们可以实现一个完整的物品图鉴系统，结合现有的背包系统，为玩家提供丰富的物品收集和查看体验。