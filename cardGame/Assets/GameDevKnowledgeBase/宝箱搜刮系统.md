# 宝箱搜刮系统知识库

## 模块概述
宝箱搜刮系统是一个完整的宝箱搜刮系统，支持战利品生成、动画效果、物品收集等功能。

## 核心功能
- 战利品生成
- 搜索动画
- 物品收集
- 稀有度系统
- 宝箱类型和等级

## 核心文件和类

### 1. UI_ChestLootWindow.cs
- **位置**: `Assets/CS2/宝箱搜刮/UI_ChestLootWindow.cs`
- **功能**: 宝箱UI管理器，负责显示和交互
- **主要功能**:
  - 宝箱UI显示
  - 物品收集
  - 搜索动画

### 2. LootGenerator.cs
- **位置**: `Assets/CS2/宝箱搜刮/LootGenerator.cs`
- **功能**: 战利品生成器，负责基于稀有度、等级、宝箱类型生成物品
- **主要功能**:
  - 战利品生成
  - 稀有度计算
  - 物品选择

### 3. LootAnimationManager.cs
- **位置**: `Assets/CS2/宝箱搜刮/LootAnimationManager.cs`
- **功能**: 战利品动画管理器，负责搜索动画序列
- **主要功能**:
  - 搜索动画
  - 物品显示动画

### 4. LootSlot.cs
- **位置**: `Assets/CS2/宝箱搜刮/LootSlot.cs`
- **功能**: 战利品槽位，负责单个物品的显示和交互
- **主要功能**:
  - 物品显示
  - 点击收集

### 5. ChestInteractable.cs
- **位置**: `Assets/CS2/宝箱搜刮/ChestInteractable.cs`
- **功能**: 宝箱可交互对象，负责处理宝箱的点击和交互
- **主要功能**:
  - 宝箱点击处理
  - 打开宝箱

## 关键API和方法

### UI_ChestLootWindow
- `OpenChest(ChestData chestData)`: 打开宝箱
- `CollectAllItems()`: 收集所有物品
- `OnItemCollected(LootSlot slot)`: 单个物品被收集后的处理

### LootGenerator
- `GenerateLoot(ChestData chestData)`: 生成战利品
- `SelectRarity()`: 选择稀有度
- `WeightedRandomSelect(List<LootTableEntry> eligibleItems)`: 加权随机选择

### LootAnimationManager
- `PlaySearchAnimationSequence(List<LootSlot> lootSlots, System.Action onComplete)`: 播放查找动画序列

### LootSlot
- `Initialize(LootItemData itemData)`: 初始化槽位
- `CollectItem()`: 收集物品

### ChestInteractable
- `OpenChest()`: 打开宝箱

## 使用示例

### 1. 打开宝箱
```csharp
// 打开宝箱
UI_ChestLootWindow.OpenChestWindow(chestData);
```

### 2. 生成战利品
```csharp
// 生成战利品
List<LootItemData> lootItems = lootGenerator.GenerateLoot(chestData);
```

### 3. 播放搜索动画
```csharp
// 播放查找动画序列
lootAnimationManager.PlaySearchAnimationSequence(lootSlots, () => {
    // 动画完成回调
});
```

## 配置和依赖
- **战利品表配置**: 需要配置战利品表
- **稀有度概率配置**: 需要配置稀有度概率
- **物品数量配置**: 需要配置物品数量
- **动画参数配置**: 需要配置动画参数

## 常见问题和解决方案

### 1. 战利品生成失败
**原因**: 战利品表配置不正确或物品预制体为空
**解决方案**: 检查战利品表配置，确保物品预制体正确设置

### 2. 搜索动画不播放
**原因**: 动画管理器未正确设置或动画参数不正确
**解决方案**: 检查动画管理器设置，确保动画参数正确

### 3. 物品收集后不添加到背包
**原因**: 背包管理器未正确设置或物品数据不正确
**解决方案**: 检查背包管理器设置，确保物品数据正确

## 扩展建议
- 添加更多宝箱类型
- 实现更复杂的战利品生成算法
- 添加战利品预览功能
- 实现战利品品质特效