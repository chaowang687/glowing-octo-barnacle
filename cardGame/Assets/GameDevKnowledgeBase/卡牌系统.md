# 卡牌系统知识库

## 模块概述
卡牌系统是一个完整的回合制卡牌战斗系统，支持能量管理、卡牌堆栈操作、多目标选择、效果执行等功能。

## 核心功能
- 能量管理（获取、消耗、重置）
- 卡牌堆栈操作（抽牌、手牌、弃牌）
- 卡牌打出和效果执行
- 多目标选择系统
- 卡组加载和管理
- 与Unity Localization系统集成

## 核心文件和类

### 1. CardSystem.cs
- **位置**: `Assets/CS/CardSystem/CardSystem.cs`
- **功能**: 卡牌系统核心组件，负责能量管理、卡牌堆栈操作以及卡牌的打出
- **主要功能**:
  - 能量管理
  - 卡牌堆栈操作
  - 卡牌打出
  - 卡组加载

### 2. CardData.cs
- **位置**: `Assets/CS/CardSystem/CardData.cs`
- **功能**: 卡牌数据定义，包含卡牌的基本属性、效果等
- **主要功能**:
  - 卡牌属性定义
  - 效果执行逻辑
  - 目标确定

### 3. CardDisplay.cs
- **位置**: `Assets/CS/CardSystem/CardDisplay.cs`
- **功能**: 卡牌的视觉显示和交互
- **主要功能**:
  - 卡牌视觉显示
  - 鼠标交互
  - 点击事件处理

### 4. CardAction.cs
- **位置**: `Assets/CS/CardSystem/CardAction.cs`
- **功能**: 卡牌行动定义，包含效果类型、目标类型、数值等

### 5. CardEnums.cs
- **位置**: `Assets/CS/CardSystem/CardEnums.cs`
- **功能**: 卡牌系统相关的枚举定义

## 关键API和方法

### CardSystem
- `DrawCards(int count)`: 抽卡逻辑
- `PlayCard(CardData card)`: 将打出的卡牌移入弃牌堆
- `GainEnergy(int amount)`: 获得能量
- `SpendEnergy(int amount)`: 消耗能量
- `ResetEnergy()`: 重置能量到最大值
- `LoadDeckFromGlobal()`: 从全局数据加载卡组

### CardData
- `ExecuteAllActions(CharacterBase source, CharacterBase selectedTarget, CardSystem cardSystem)`: 执行所有行动
- `ExecuteEffects(CharacterBase source, CharacterBase target, CardSystem cardSystem)`: 执行效果

## 使用示例

### 1. 抽卡
```csharp
// 抽5张卡
cardSystem.DrawCards(5);
```

### 2. 打出卡牌
```csharp
// 检查卡牌是否可打出
if (cardSystem.CanPlayCard(card)) {
    // 打出卡牌
    cardSystem.PlayCard(card);
    // 执行卡牌效果
    card.ExecuteEffects(source, target, cardSystem);
}
```

### 3. 能量管理
```csharp
// 获得能量
cardSystem.GainEnergy(1);

// 消耗能量
cardSystem.SpendEnergy(card.energyCost);

// 重置能量
cardSystem.ResetEnergy();
```

## 配置和依赖
- **卡牌预制体**: 需要设置卡牌显示预制体
- **CharacterManager**: 用于目标验证
- **LocalizationSettings**: 用于卡牌文本本地化

## 常见问题和解决方案

### 1. 卡牌效果不执行
**原因**: 目标确定逻辑错误或效果执行顺序问题
**解决方案**: 检查CardData中的ExecuteAllActions方法，确保目标确定正确

### 2. 能量显示不正确
**原因**: 能量变更后未触发UI更新
**解决方案**: 确保能量变更后调用OnEnergyChanged事件

### 3. 卡组加载失败
**原因**: 卡牌ID与Resources路径不匹配
**解决方案**: 检查LoadDeckFromGlobal方法中的资源加载路径

## 扩展建议
- 添加卡牌升级系统
- 实现卡牌组合效果
- 添加卡牌动画和特效
- 实现卡牌收藏和管理系统